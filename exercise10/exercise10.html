<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">

    <title>Animation</title>

    <link rel="stylesheet" href="../styles.css">

    <script src="../drawing.js"></script>
    <script src="../objects.js"></script>
        <!--[if lt IE 9]>
        <script
        src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js">
        </script>
        <![endif]-->

</head>

<body>
  <h1>Animation</h1>
  <canvas id="pacman" width="300" height="300" tabindex="1"></canvas>
  <script>
    let context = document.getElementById("pacman").getContext("2d");
    let pacman = new PacMan(150, 150, 20, 120);
    let ghosts = [
      new Ghost(Math.random() * 300, Math.random() * 300, 20, 70, 'red'),
      new Ghost(Math.random() * 300, Math.random() * 300, 20, 70, 'pink'),
      new Ghost(Math.random() * 300, Math.random() * 300, 20, 70, 'cyan'),
      new Ghost(Math.random() * 300, Math.random() * 300, 20, 70, 'orange')
    ]
    let draw = (ctx, guide) => {
      pacman.draw(ctx)
      ghosts.forEach((ghost) => {
        ghost.draw(context, guide)
      })
    }

    let update = (elapsed) => {
      pacman.update(elapsed, 300, 300)
      ghosts.forEach((ghost) => {
        ghost.update(pacman, elapsed)
      })
    }

    let previous, elapsed;

    let frame = (timestamp) => {
      context.clearRect(0, 0, context.canvas.width, context.canvas.height);
      if (!previous) previous = timestamp;
      elapsed = timestamp - previous;
      update(elapsed / 1000);
      draw(context, true);
      previous = timestamp;
      window.requestAnimationFrame(frame);
    }
    window.requestAnimationFrame(frame);

    let handleKeydown = (e) => {
      let key = e.key || e.keyCode;
      let nothingHandled = false;
      switch(key) {
        case "ArrowLeft":
        case 37:
          pacman.moveLeft();
          break;
        case "ArrowUp":
        case 38:
          pacman.moveUp();
          break;
        case "ArrowRight":
        case 39:
          pacman.moveRight();
          break;
        case "ArrowDown":
        case 40:
          pacman.moveDown();
          break;
        default:
          nothingHandled = true;
      }
      if (!nothingHandled) e.preventDefault();
    }

    context.canvas.addEventListener("keydown", handleKeydown);
    context.canvas.focus();
  </script>
</body>
</html>

